{% extends 'core/base.html' %}
{% load static %}

{% block title %}Editar Perfil{% endblock %}
{% block header_title %}Editar Perfil{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/cadastro_aluno.css' %}">
{% endblock %}

{% block content %}
<div class="container">

    <h2 style="text-align:center;">Editar Perfil</h2>

    <!-- FOTO ATUAL / PREVIEW -->
    <div style="text-align:center; margin-bottom:20px;">
        {% if perfil and perfil.foto %}
            <img id="preview-img" src="{{ perfil.foto.url }}" class="foto-perfil-preview">
        {% else %}
            <div id="preview-img"
                 class="foto-perfil-preview foto-default">
                <i class="fa-solid fa-user"></i>
            </div>
        {% endif %}
    </div>

    <!-- BOTÃO REMOVER FOTO -->
    {% if perfil and perfil.foto %}
        <form method="post" action="{% url 'remover_foto_perfil' %}" style="text-align:center; margin-bottom:20px;">
            {% csrf_token %}
            <button type="submit" class="submit-btn" style="background:#c62828;">
                Remover Foto
            </button>
        </form>
    {% endif %}

    <!-- FORMULÁRIO -->
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        {{ form.as_p }}

        <label><strong>Nova Foto de Perfil:</strong></label>
        <input type="file" name="foto" id="foto-input" style="margin-top:10px;">

        <button type="submit" class="submit-btn" style="margin-top:20px;">Salvar</button>
    </form>

</div>

<!-- JS DO PREVIEW DA IMAGEM -->
<script>
document.getElementById("foto-input").addEventListener("change", function() {
    const file = this.files[0];
    const preview = document.getElementById("preview-img");

    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {

            // Se preview ainda é um DIV, troca para IMG
            if (preview.tagName.toLowerCase() === "div") {
                const img = document.createElement("img");
                img.id = "preview-img";
                img.className = "foto-perfil-preview";
                img.src = e.target.result;
                
                preview.replaceWith(img);
            } else {
                preview.src = e.target.result;
            }
        }
        reader.readAsDataURL(file);
    }
});
</script>

{% endblock %}
